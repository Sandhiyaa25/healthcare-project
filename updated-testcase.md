# Healthcare API — Complete Test Case Documentation

> **Generated by:** Senior QA Engineer + Backend Architect Analysis
> **Project:** Multi-Tenant Healthcare Platform (PHP, MySQL, JWT)
> **Base URL:** `http://localhost/healthcare-project/public`
> **Total Modules:** 12 | **Total Test Cases:** 120

---

## SECTION 1 — TEST CASE SETUP GUIDE

### 1.1 Base URL Configuration

```
Base URL:  http://localhost/healthcare-project/public
API Prefix: /api

Full example: http://localhost/healthcare-project/public/api/health
```

### 1.2 How to Get a JWT Token (Tenant User)

**Step 1 — Login (POST /api/auth/login)**

```json
POST http://localhost/healthcare-project/public/api/auth/login
Content-Type: application/json

{
  "tenant_id": 1,
  "username": "admin",
  "password": "Admin@123456"
}
```

**Response Fields to Save:**
- `data.access_token` → Use as Bearer token in `Authorization` header
- `data.csrf_token`   → Use in `X-CSRF-Token` header for all POST/PUT/PATCH/DELETE requests
- Refresh token is set automatically as an **HttpOnly cookie** named `refresh_token`

---

### 1.3 Required Headers for Every Protected Request

| Header | Value | Required For |
|--------|-------|--------------|
| `Authorization` | `Bearer <access_token>` | All protected routes |
| `X-CSRF-Token` | `<csrf_token>` | POST, PUT, PATCH, DELETE only |
| `Content-Type` | `application/json` | POST, PUT, PATCH with body |

> **GET requests** do NOT require `X-CSRF-Token` or `Content-Type`.

---

### 1.4 Role-Wise Login Credentials (Seed Data)

| Role | Username | Password | Tenant ID |
|------|----------|----------|-----------|
| Admin | `admin` | `Admin@123456` | `1` |
| Doctor | `dr_sharma` | `Doctor@123456` | `1` |
| Platform Admin | `platform_admin` | `Platform@123` | N/A (no tenant_id) |

> **Note:** Nurse, Receptionist, Pharmacist, and Patient users must be created via the Admin account. Use `POST /api/users` to create them, then `POST /api/patients` if creating a patient record.

---

### 1.5 Platform Admin vs. Tenant Admin

| Feature | Platform Admin | Tenant Admin (role=admin) |
|---------|---------------|--------------------------|
| Login endpoint | `POST /api/platform/login` | `POST /api/auth/login` |
| Auth header | `Authorization: Bearer <platform_token>` | `Authorization: Bearer <access_token>` |
| CSRF header | `X-CSRF-Token` (platform CSRF) | `X-CSRF-Token` (tenant CSRF) |
| Scope | Manage tenants globally | Manage users/patients within tenant |

---

### 1.6 Test Data Prerequisites

Before running module-specific tests, ensure the following records exist in the database (tenant_id = 1):

| Resource | Prerequisite |
|----------|-------------|
| Users | Seed data creates `admin` (role=admin) and `dr_sharma` (role=doctor) |
| Patients | Create at least one patient via `POST /api/patients` |
| Appointments | Create at least one appointment linking a patient + doctor |
| Prescriptions | Create via doctor account; requires patient_id |
| Invoices | Create via receptionist/admin; requires patient_id |
| Staff records | Create via admin; requires user_id and role_id |

---

### 1.7 Postman Environment Variables (Recommended)

```
base_url        = http://localhost/healthcare-project/public
access_token    = <from login response>
csrf_token      = <from login response>
tenant_id       = 1
patient_id      = 1
appointment_id  = 1
prescription_id = 1
invoice_id      = 1
user_id         = 1
staff_id        = 1
record_id       = 1
platform_token  = <from platform login>
platform_csrf   = <from platform CSRF regenerate>
```

---

## SECTION 2 — MODULE-WISE TEST CASES

---

## MODULE 1 — Public & Health Check (3 Test Cases)

---

### TC-1.01 ✅ Health Check — API Running

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/health`
- **Headers:** *(none required)*
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "app": "Healthcare API",
    "status": "running",
    "php": "8.x.x"
  },
  "message": "API is healthy"
}
```
- **Notes:** No auth required. Verifies router and PHP are working.

---

### TC-1.02 ✅ Register New Tenant — Valid Data

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/register`
- **Headers:**
  ```
  Content-Type: application/json
  ```
- **Body:**
```json
{
  "hospital_name": "City Medical Center",
  "subdomain": "city-medical",
  "contact_email": "admin@citymedical.com",
  "contact_phone": "+91-9876543210",
  "admin_username": "cityadmin",
  "admin_password": "CityAdmin@123",
  "admin_first_name": "City",
  "admin_last_name": "Admin",
  "subscription_plan": "trial"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "tenant_id": 2,
    "message": "Registration successful. Your account is pending approval.",
    "subdomain": "city-medical"
  },
  "message": "Registration submitted. Awaiting admin approval."
}
```
- **Notes:** Tenant created with `status=inactive`. Must be approved by Platform Admin before users can log in.

---

### TC-1.03 ❌ Register Tenant — Missing Required Fields

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/register`
- **Headers:**
  ```
  Content-Type: application/json
  ```
- **Body:**
```json
{
  "hospital_name": "",
  "subdomain": "city-medical",
  "contact_email": "not-an-email",
  "admin_username": "",
  "admin_password": "short"
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Registration validation failed",
  "details": {
    "hospital_name": "Hospital name is required",
    "contact_email": "Valid contact email is required",
    "admin_username": "Admin username is required",
    "admin_password": "Admin password must be at least 8 characters"
  }
}
```
- **Notes:** Validates: hospital_name, subdomain format (`[a-z0-9-]+`), contact_email (valid email), admin_username, admin_password (min 8 chars).

---

## MODULE 2 — Authentication (10 Test Cases)

---

### TC-2.01 ✅ Login — Valid Admin Credentials

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Headers:**
  ```
  Content-Type: application/json
  ```
- **Body:**
```json
{
  "tenant_id": 1,
  "username": "admin",
  "password": "Admin@123456"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "access_token": "eyJ...",
    "csrf_token": "eyJ...",
    "token_type": "Bearer",
    "expires_in": 3600,
    "user": {
      "id": 1,
      "tenant_id": 1,
      "role_id": 1,
      "username": "admin",
      "email": "admin@apollo-chennai.com",
      "first_name": "Super",
      "last_name": "Admin",
      "role_slug": "admin",
      "status": "active"
    }
  },
  "message": "Login successful"
}
```
- **Notes:** `refresh_token` set as HttpOnly cookie. Save `access_token` and `csrf_token`.

---

### TC-2.02 ✅ Login — Valid Doctor Credentials

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Headers:**
  ```
  Content-Type: application/json
  ```
- **Body:**
```json
{
  "tenant_id": 1,
  "username": "dr_sharma",
  "password": "Doctor@123456"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:** Same structure as TC-2.01 with `role_slug: "doctor"`.

---

### TC-2.03 ❌ Login — Wrong Password

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Body:**
```json
{
  "tenant_id": 1,
  "username": "admin",
  "password": "WrongPassword"
}
```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Invalid credentials"
}
```
- **Notes:** Each failed attempt increments `failed_login_attempts`. After 5 failures, account is locked for 15 minutes.

---

### TC-2.04 ❌ Login — Non-Existent Username

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Body:**
```json
{
  "tenant_id": 1,
  "username": "ghost_user",
  "password": "SomePassword"
}
```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Invalid credentials"
}
```
- **Notes:** Returns same error as wrong password to prevent username enumeration.

---

### TC-2.05 ❌ Login — Invalid or Inactive Tenant

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Body:**
```json
{
  "tenant_id": 9999,
  "username": "admin",
  "password": "Admin@123456"
}
```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Invalid tenant or tenant is inactive"
}
```

---

### TC-2.06 ❌ Login — Missing Fields

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Body:**
```json
{
  "tenant_id": 1
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "tenant_id, username and password are required"
}
```

---

### TC-2.07 ❌ Login — Account Locked (After 5 Failures)

- **Prerequisite:** Attempt login 5 times with wrong password for the same user.
- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Body:**
```json
{
  "tenant_id": 1,
  "username": "admin",
  "password": "Admin@123456"
}
```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Account is temporarily locked. Please try again later."
}
```
- **Notes:** Lock duration is 15 minutes. Even correct password is rejected during lockout.

---

### TC-2.08 ✅ Logout — Valid Token

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/logout`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Logged out successfully"
}
```
- **Notes:** Revokes all refresh tokens for this user+tenant. Clears `refresh_token` cookie. No CSRF required for logout.

---

### TC-2.09 ✅ Refresh Token — Valid Cookie Present

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/refresh`
- **Headers:** *(none — refresh token is in HttpOnly cookie)*
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "access_token": "eyJ...",
    "csrf_token": "eyJ...",
    "token_type": "Bearer",
    "expires_in": 3600
  },
  "message": "Token refreshed successfully"
}
```
- **Notes:** Old refresh token is revoked (token rotation). New `refresh_token` cookie is set.

---

### TC-2.10 ✅ Regenerate CSRF Token

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/csrf/regenerate`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "csrf_token": "eyJ..."
  },
  "message": "CSRF token regenerated"
}
```
- **Notes:** Use this when the CSRF token expires (default: 3600s). No `X-CSRF-Token` required for this route.

---

## MODULE 3 — User Management (12 Test Cases)

> **Access:** Admin role only. All routes require `Authorization: Bearer` + `X-CSRF-Token` (for mutations).

---

### TC-3.01 ✅ List All Users (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/users`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params (optional):**
  - `page=1`
  - `per_page=20`
  - `role_id=2`
  - `status=active`
  - `search=sharma`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenant_id": 1,
      "role_id": 1,
      "username": "admin",
      "email": "admin@apollo-chennai.com",
      "first_name": "Super",
      "last_name": "Admin",
      "status": "active"
    }
  ],
  "message": "Users retrieved"
}
```

---

### TC-3.02 ✅ Get Single User by ID (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/users/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "tenant_id": 1,
    "username": "admin",
    "email": "admin@apollo-chennai.com",
    "role_id": 1,
    "status": "active"
  },
  "message": "User retrieved"
}
```

---

### TC-3.03 ✅ Create New User (Admin)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/users`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "username": "nurse_priya",
  "email": "priya@apollo-chennai.com",
  "password": "Nurse@1234",
  "role_id": 3,
  "first_name": "Priya",
  "last_name": "Kumari",
  "phone": "+91-9123456789",
  "status": "active"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 3,
    "tenant_id": 1,
    "username": "nurse_priya",
    "email": "priya@apollo-chennai.com",
    "role_id": 3,
    "status": "active"
  },
  "message": "User created successfully"
}
```
- **Notes:** `role_id` must belong to the tenant. Email must be unique within tenant. Max users limit enforced.

---

### TC-3.04 ❌ Create User — Duplicate Email

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/users`
- **Headers:** *(admin auth + CSRF)*
- **Body:**
```json
{
  "username": "another_admin",
  "email": "admin@apollo-chennai.com",
  "password": "Admin@1234",
  "role_id": 1
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Validation failed",
  "details": {
    "email": "Email already exists"
  }
}
```

---

### TC-3.05 ❌ Create User — Invalid Role ID

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/users`
- **Headers:** *(admin auth + CSRF)*
- **Body:**
```json
{
  "username": "new_user",
  "email": "new@apollo-chennai.com",
  "password": "User@1234",
  "role_id": 9999
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Invalid role for this tenant"
}
```

---

### TC-3.06 ✅ Update User (Admin)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/users/3`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "first_name": "Priya",
  "last_name": "Sharma",
  "phone": "+91-9000000001",
  "status": "active",
  "role_id": 3
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 3, "first_name": "Priya", "last_name": "Sharma" },
  "message": "User updated successfully"
}
```
- **Notes:** Password cannot be updated via this endpoint. Use `PUT /api/users/me/password` instead.

---

### TC-3.07 ❌ Update User — Attempt to Change Password

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/users/3`
- **Headers:** *(admin auth + CSRF)*
- **Body:**
```json
{
  "first_name": "Priya",
  "last_name": "Sharma",
  "role_id": 3,
  "password": "NewPassword@123"
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Validation failed",
  "details": {
    "password": "Password cannot be changed through this endpoint. Use PUT /api/users/me/password"
  }
}
```

---

### TC-3.08 ✅ Delete User (Admin)

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/users/3`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  X-CSRF-Token: <csrf_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "User deleted successfully"
}
```
- **Notes:** Soft delete — sets `status=deleted`. Cannot delete your own account.

---

### TC-3.09 ❌ Delete User — Self-Delete Not Allowed

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/users/1`  *(admin deleting self)*
- **Headers:** *(admin auth + CSRF)*
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "You cannot delete your own account"
}
```

---

### TC-3.10 ✅ Change Own Password

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/users/me/password`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "current_password": "Admin@123456",
  "new_password": "NewAdmin@9999"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Password changed successfully"
}
```

---

### TC-3.11 ❌ Change Password — Wrong Current Password

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/users/me/password`
- **Headers:** *(auth + CSRF)*
- **Body:**
```json
{
  "current_password": "WrongOldPassword",
  "new_password": "NewPassword@123"
}
```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Current password is incorrect"
}
```

---

### TC-3.12 ✅ Admin Reset User Password

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/users/2/reset-password`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "new_password": "Reset@123456"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Password reset successfully"
}
```
- **Notes:** Sets `must_change_password=true` on target user. Audit log created with severity=warning.

---

## MODULE 4 — Patient Management (12 Test Cases)

> **Roles:** Admin/Doctor/Nurse/Receptionist can manage. Patient role can only self-service via `/api/patients/me`.

---

### TC-4.01 ✅ List All Patients (Staff)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  ```
- **Query Params (optional):** `page=1&per_page=20&search=john&status=active`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenant_id": 1,
      "first_name": "John",
      "last_name": "Doe",
      "date_of_birth": "1990-01-15",
      "gender": "male",
      "email": "john@example.com",
      "phone": "+91-9000000001",
      "blood_group": "O+",
      "status": "active"
    }
  ],
  "message": "Patients retrieved"
}
```

---

### TC-4.02 ❌ List All Patients — Patient Role Denied

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients`
- **Headers:**
  ```
  Authorization: Bearer <patient_role_token>
  ```
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Patients cannot list all records. Use GET /api/patients/me",
  "code": "FORBIDDEN"
}
```

---

### TC-4.03 ✅ Get Own Profile (Patient Role)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients/me`
- **Headers:**
  ```
  Authorization: Bearer <patient_role_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "tenant_id": 1,
    "user_id": 5,
    "first_name": "Jane",
    "last_name": "Patient",
    "date_of_birth": "1995-05-20",
    "gender": "female",
    "email": "jane@example.com",
    "phone": "+91-9000000099"
  },
  "message": "Your profile retrieved"
}
```

---

### TC-4.04 ✅ Update Own Profile (Patient Role — Limited Fields)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/patients/me`
- **Headers:**
  ```
  Authorization: Bearer <patient_role_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "phone": "+91-9111111111",
  "address": "123 Main Street, Chennai",
  "emergency_contact_name": "Ravi Kumar",
  "emergency_contact_phone": "+91-9222222222"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "phone": "+91-9111111111" },
  "message": "Your profile updated"
}
```

---

### TC-4.05 ✅ Get Patient by ID (Staff)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:** Full patient object with all fields.

---

### TC-4.06 ❌ Get Another Patient's Record (Patient Role)

- **Prerequisite:** Logged in as patient with `user_id=5`, trying to access patient `id=2` (belongs to `user_id=6`).
- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients/2`
- **Headers:**
  ```
  Authorization: Bearer <patient_role_token>
  ```
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "You can only view your own record",
  "code": "FORBIDDEN"
}
```

---

### TC-4.07 ✅ Create Patient (Staff)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/patients`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_nurse_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "first_name": "Arjun",
  "last_name": "Mehta",
  "date_of_birth": "1985-03-12",
  "gender": "male",
  "email": "arjun.mehta@example.com",
  "phone": "+91-9888888881",
  "address": "45 Brigade Road, Bangalore",
  "blood_group": "B+",
  "emergency_contact_name": "Sunita Mehta",
  "emergency_contact_phone": "+91-9888888882",
  "allergies": "Penicillin",
  "medical_notes": "Diabetic patient"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "tenant_id": 1,
    "first_name": "Arjun",
    "last_name": "Mehta",
    "status": "active"
  },
  "message": "Patient created successfully"
}
```

---

### TC-4.08 ❌ Create Patient — Patient Role Denied

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/patients`
- **Headers:** *(patient role auth + CSRF)*
- **Body:** *(any valid patient body)*
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Patients cannot create records directly. Contact reception.",
  "code": "FORBIDDEN"
}
```

---

### TC-4.09 ✅ Update Patient (Staff)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/patients/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "first_name": "Arjun",
  "last_name": "Mehta",
  "date_of_birth": "1985-03-12",
  "gender": "male",
  "phone": "+91-9000000002",
  "allergies": "Penicillin, Sulfa drugs"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "phone": "+91-9000000002" },
  "message": "Patient updated successfully"
}
```

---

### TC-4.10 ❌ Update Patient — Patient Role Denied (via /api/patients/{id})

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/patients/1`
- **Headers:** *(patient role auth + CSRF)*
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Use PUT /api/patients/me to update your own profile",
  "code": "FORBIDDEN"
}
```

---

### TC-4.11 ✅ Delete Patient (Admin Only)

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/patients/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  X-CSRF-Token: <csrf_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Patient deleted successfully"
}
```
- **Notes:** Soft delete — sets `deleted_at` timestamp.

---

### TC-4.12 ❌ Delete Patient — Non-Admin Role

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/patients/1`
- **Headers:** *(doctor or nurse auth + CSRF)*
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Only admin can delete patient records",
  "code": "FORBIDDEN"
}
```

---

## MODULE 5 — Appointments (14 Test Cases)

> **Roles:** Admin/Doctor/Nurse/Patient can create. Admin/Doctor/Nurse can update/change status. Patient can only cancel own.

---

### TC-5.01 ✅ List All Appointments (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params:** `page=1&per_page=20&status=scheduled&date=2026-02-20&patient_id=1&doctor_id=2`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenant_id": 1,
      "patient_id": 1,
      "doctor_id": 2,
      "appointment_date": "2026-02-20",
      "start_time": "10:00:00",
      "end_time": "10:30:00",
      "status": "scheduled",
      "type": "consultation"
    }
  ],
  "message": "Appointments retrieved"
}
```

---

### TC-5.02 ✅ List Appointments (Doctor — Own Only)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  ```
- **Expected Status:** `200 OK`
- **Notes:** Doctor automatically sees only appointments where `doctor_id = auth_user_id`. No manual filter needed.

---

### TC-5.03 ✅ List Appointments (Patient — Own Only)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments`
- **Headers:**
  ```
  Authorization: Bearer <patient_access_token>
  ```
- **Expected Status:** `200 OK`
- **Notes:** Patient sees only appointments where their patient record is linked via `user_id`.

---

### TC-5.04 ✅ Get Upcoming Appointments (All Roles)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/upcoming`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Query Params (optional for admin/nurse):** `doctor_id=2`
- **Expected Status:** `200 OK`
- **Notes:** Returns appointments for next 30 days. Doctors see own only. Patients see own only.

---

### TC-5.05 ✅ Get Single Appointment (Admin/Doctor/Nurse)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "patient_id": 1,
    "doctor_id": 2,
    "appointment_date": "2026-02-20",
    "start_time": "10:00:00",
    "end_time": "10:30:00",
    "status": "scheduled",
    "type": "consultation",
    "notes": "Follow-up check"
  },
  "message": "Appointment retrieved"
}
```

---

### TC-5.06 ❌ Get Appointment — Patient Views Another's Appointment

- **Prerequisite:** Patient (user_id=5) is NOT the patient in appointment id=1.
- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1`
- **Headers:**
  ```
  Authorization: Bearer <patient_access_token>
  ```
- **Expected Status:** `403 Forbidden`

---

### TC-5.07 ✅ Create Appointment (Staff)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/appointments`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_nurse_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "patient_id": 1,
  "doctor_id": 2,
  "appointment_date": "2026-03-01",
  "start_time": "09:00",
  "end_time": "09:30",
  "type": "consultation",
  "notes": "Initial consultation for headache"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "patient_id": 1,
    "doctor_id": 2,
    "appointment_date": "2026-03-01",
    "status": "scheduled"
  },
  "message": "Appointment created"
}
```

---

### TC-5.08 ✅ Create Appointment (Patient — Books Self)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/appointments`
- **Headers:**
  ```
  Authorization: Bearer <patient_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "doctor_id": 2,
  "appointment_date": "2026-03-05",
  "start_time": "11:00",
  "end_time": "11:30",
  "type": "consultation",
  "notes": "Routine checkup"
}
```
- **Expected Status:** `201 Created`
- **Notes:** Patient does NOT send `patient_id`. The system auto-resolves it from `user_id` linked to their patient record.

---

### TC-5.09 ✅ Update Appointment (Staff)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "appointment_date": "2026-03-02",
  "start_time": "14:00",
  "end_time": "14:30",
  "notes": "Rescheduled by doctor"
}
```
- **Expected Status:** `200 OK`

---

### TC-5.10 ❌ Update Appointment — Patient Role Denied

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1`
- **Headers:** *(patient role auth + CSRF)*
- **Body:** *(any body)*
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Patients cannot modify appointment details. Use PATCH /api/appointments/{id}/cancel to cancel.",
  "code": "FORBIDDEN"
}
```

---

### TC-5.11 ✅ Cancel Appointment (Patient — Own)

- **Prerequisite:** Patient owns appointment id=2.
- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/2/cancel`
- **Headers:**
  ```
  Authorization: Bearer <patient_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:** *(empty `{}` or no body)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Appointment cancelled"
}
```

---

### TC-5.12 ❌ Cancel Appointment — Patient Cancels Another Patient's

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1/cancel`
- **Headers:** *(patient role auth + CSRF — patient does NOT own appointment 1)*
- **Expected Status:** `403 Forbidden`

---

### TC-5.13 ✅ Update Appointment Status (Staff)

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1/status`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "status": "confirmed"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "status": "confirmed" },
  "message": "Appointment status updated"
}
```
- **Valid Status Values:** `scheduled`, `confirmed`, `cancelled`, `completed`, `no_show`

---

### TC-5.14 ❌ Update Status — Patient Role Denied

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/appointments/1/status`
- **Headers:** *(patient role auth + CSRF)*
- **Body:** `{ "status": "completed" }`
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Patients cannot update appointment status",
  "code": "FORBIDDEN"
}
```

---

## MODULE 6 — Prescriptions (8 Test Cases)

> **Create:** Doctor only. **Verify/Reject:** Pharmacist only. **View:** All staff + patient (own).

---

### TC-6.01 ✅ List Prescriptions (Admin — All)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params:** `patient_id=1&status=pending&doctor_id=2&page=1&per_page=20`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "patient_id": 1,
      "doctor_id": 2,
      "medicines": [{"name": "Paracetamol", "dosage": "500mg", "frequency": "TID", "duration": "5 days"}],
      "diagnosis": "Viral fever",
      "status": "pending"
    }
  ],
  "message": "Prescriptions retrieved"
}
```

---

### TC-6.02 ✅ List Prescriptions (Doctor — Own Only)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  ```
- **Expected Status:** `200 OK`
- **Notes:** Doctor automatically sees only prescriptions where `doctor_id = auth_user_id`.

---

### TC-6.03 ✅ Get Prescription by ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions/1`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`

---

### TC-6.04 ✅ Create Prescription (Doctor)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "patient_id": 1,
  "appointment_id": 1,
  "diagnosis": "Hypertension Stage 1",
  "notes": "Monitor BP weekly",
  "medicines": [
    {
      "name": "Amlodipine",
      "dosage": "5mg",
      "frequency": "Once daily",
      "duration": "30 days"
    },
    {
      "name": "Aspirin",
      "dosage": "75mg",
      "frequency": "Once daily",
      "duration": "30 days"
    }
  ]
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "patient_id": 1,
    "doctor_id": 2,
    "status": "pending",
    "medicines": [...]
  },
  "message": "Prescription created"
}
```
- **Notes:** `status` defaults to `pending`. `doctor_id` is auto-set from the authenticated user's `auth_user_id`.

---

### TC-6.05 ✅ Verify Prescription (Pharmacist — Dispense)

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions/1/verify`
- **Headers:**
  ```
  Authorization: Bearer <pharmacist_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "status": "dispensed"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "status": "dispensed",
    "verified_by": 4,
    "verified_at": "2026-02-20T10:00:00"
  },
  "message": "Prescription status updated"
}
```

---

### TC-6.06 ✅ Reject Prescription (Pharmacist)

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions/1/verify`
- **Headers:** *(pharmacist auth + CSRF)*
- **Body:**
```json
{
  "status": "rejected"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:** `{ "status": "rejected", "verified_by": 4 }`

---

### TC-6.07 ❌ Create Prescription — Non-Doctor (Nurse)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions`
- **Headers:** *(nurse auth + CSRF)*
- **Body:** *(valid prescription body)*
- **Notes:** Nurse does not have `prescriptions.create` permission. Behavior depends on service-level validation — expect `403` or `422`.
- **Expected Status:** `403 Forbidden`

---

### TC-6.08 ❌ Verify Prescription — Non-Pharmacist (Doctor)

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/prescriptions/1/verify`
- **Headers:** *(doctor auth + CSRF)*
- **Body:** `{ "status": "dispensed" }`
- **Notes:** Pharmacist-only action. Service should validate role.
- **Expected Status:** `403 Forbidden`

---

## MODULE 7 — Billing / Invoices (10 Test Cases)

> **Access:** Receptionist and Admin manage. All authenticated staff can view.

---

### TC-7.01 ✅ List Invoices

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/billing`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_receptionist_token>
  ```
- **Query Params:** `patient_id=1&status=pending&page=1&per_page=20`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "patient_id": 1,
      "amount": 500.00,
      "tax": 50.00,
      "discount": 0.00,
      "total_amount": 550.00,
      "status": "pending",
      "due_date": "2026-03-01"
    }
  ],
  "message": "Invoices retrieved"
}
```

---

### TC-7.02 ✅ Get Invoice by ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/billing/1`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`

---

### TC-7.03 ✅ Get Billing Summary

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/billing/summary`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "total_invoices": 10,
    "total_pending": 3,
    "total_paid": 7,
    "total_amount": 55000.00,
    "total_collected": 38500.00
  },
  "message": "Billing summary"
}
```

---

### TC-7.04 ✅ Create Invoice (Receptionist/Admin)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing`
- **Headers:**
  ```
  Authorization: Bearer <receptionist_or_admin_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "patient_id": 1,
  "appointment_id": 1,
  "amount": 1000.00,
  "tax": 180.00,
  "discount": 50.00,
  "total_amount": 1130.00,
  "due_date": "2026-03-15",
  "notes": "Consultation + Blood test",
  "line_items": [
    { "description": "Doctor Consultation", "quantity": 1, "unit_price": 800.00 },
    { "description": "Blood Test (CBC)", "quantity": 1, "unit_price": 200.00 }
  ]
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "patient_id": 1,
    "total_amount": 1130.00,
    "status": "pending"
  },
  "message": "Invoice created"
}
```

---

### TC-7.05 ✅ Record Payment — Cash

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing/1/payment`
- **Headers:**
  ```
  Authorization: Bearer <receptionist_or_admin_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "amount": 550.00,
  "payment_method": "cash",
  "reference_number": null,
  "notes": "Paid in full at counter"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "status": "paid" },
  "message": "Payment recorded"
}
```

---

### TC-7.06 ✅ Record Payment — UPI

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing/1/payment`
- **Headers:** *(receptionist auth + CSRF)*
- **Body:**
```json
{
  "amount": 550.00,
  "payment_method": "upi",
  "reference_number": "UPI-TXN-20260220-001",
  "notes": "Paid via Google Pay"
}
```
- **Expected Status:** `200 OK`
- **Notes:** Valid payment methods: `cash`, `card`, `upi`, `bank_transfer`, `insurance`.

---

### TC-7.07 ❌ Record Payment — Invalid Payment Method

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing/1/payment`
- **Headers:** *(auth + CSRF)*
- **Body:**
```json
{
  "amount": 100.00,
  "payment_method": "crypto"
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Notes:** Only `cash`, `card`, `upi`, `bank_transfer`, `insurance` are valid.

---

### TC-7.08 ❌ Create Invoice — Invoice for Non-Existent Patient

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing`
- **Headers:** *(auth + CSRF)*
- **Body:**
```json
{
  "patient_id": 9999,
  "amount": 500.00,
  "tax": 0.00,
  "total_amount": 500.00
}
```
- **Expected Status:** `422 Unprocessable Entity` or `404 Not Found`

---

### TC-7.09 ❌ Access Billing — Unauthenticated

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/billing`
- **Headers:** *(none)*
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Unauthorized. Token missing or invalid."
}
```

---

### TC-7.10 ❌ Create Invoice — Missing CSRF Token

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/billing`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  Content-Type: application/json
  ```
  *(X-CSRF-Token header intentionally omitted)*
- **Body:** *(valid body)*
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Invalid or missing CSRF token"
}
```

---

## MODULE 8 — Staff Management (8 Test Cases)

> **Access:** Admin role manages. All authenticated staff can view.

---

### TC-8.01 ✅ List All Staff

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/staff`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params:** `role_id=2&status=active&page=1&per_page=20`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenant_id": 1,
      "user_id": 2,
      "role_id": 2,
      "department": "Cardiology",
      "specialization": "Interventional Cardiology",
      "license_number": "MCI-2020-12345",
      "status": "active"
    }
  ],
  "message": "Staff retrieved"
}
```

---

### TC-8.02 ✅ Get Staff by ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/staff/1`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`

---

### TC-8.03 ✅ Create Staff (Admin)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/staff`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "user_id": 2,
  "role_id": 2,
  "department": "Cardiology",
  "specialization": "Interventional Cardiology",
  "license_number": "MCI-2020-12345",
  "status": "active"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "user_id": 2,
    "department": "Cardiology",
    "status": "active"
  },
  "message": "Staff created"
}
```

---

### TC-8.04 ✅ Update Staff (Admin)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/staff/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "department": "General Medicine",
  "specialization": "Internal Medicine",
  "license_number": "MCI-2020-12345",
  "status": "active",
  "role_id": 2
}
```
- **Expected Status:** `200 OK`

---

### TC-8.05 ✅ Delete Staff (Admin)

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/staff/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  X-CSRF-Token: <csrf_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Staff deleted"
}
```
- **Notes:** Soft delete — sets `deleted_at` timestamp.

---

### TC-8.06 ❌ Create Staff — Non-Existent User ID

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/staff`
- **Headers:** *(admin auth + CSRF)*
- **Body:**
```json
{
  "user_id": 9999,
  "role_id": 2,
  "department": "Cardiology"
}
```
- **Expected Status:** `422 Unprocessable Entity` or `404 Not Found`

---

### TC-8.07 ❌ Delete Staff — Missing CSRF Token

- **Method:** `DELETE`
- **URL:** `http://localhost/healthcare-project/public/api/staff/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
  *(X-CSRF-Token intentionally missing)*
- **Expected Status:** `403 Forbidden`

---

### TC-8.08 ❌ Access Staff — Without Authentication

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/staff`
- **Headers:** *(none)*
- **Expected Status:** `401 Unauthorized`

---

## MODULE 9 — Medical Records (8 Test Cases)

> **Create/Update:** Doctor only (auth_user_id becomes doctor_id). **View:** All authenticated staff.

---

### TC-9.01 ✅ Get Medical Records by Patient ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/records/patient/1`
- **Headers:**
  ```
  Authorization: Bearer <admin_or_doctor_token>
  ```
- **Query Params:** `page=1&per_page=20`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "patient_id": 1,
      "doctor_id": 2,
      "record_type": "consultation",
      "chief_complaint": "Persistent headache for 3 days",
      "diagnosis": "Tension headache",
      "treatment": "Rest, hydration, Paracetamol 500mg",
      "vital_signs": { "bp": "120/80", "pulse": 72, "temperature": 98.6 }
    }
  ],
  "message": "Medical records retrieved"
}
```

---

### TC-9.02 ✅ Get Medical Record by ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/records/1`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`

---

### TC-9.03 ✅ Create Medical Record (Doctor)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/records`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "patient_id": 1,
  "appointment_id": 1,
  "record_type": "consultation",
  "chief_complaint": "Persistent headache and fatigue",
  "diagnosis": "Tension-type headache",
  "treatment": "Rest and Paracetamol 500mg TDS x 5 days",
  "vital_signs": {
    "bp": "120/80",
    "pulse": 72,
    "temperature": 98.4,
    "spo2": 99,
    "weight_kg": 70
  },
  "lab_results": {
    "CBC": "Normal",
    "Blood Sugar (Fasting)": "95 mg/dL"
  },
  "notes": "Patient advised to reduce screen time"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "patient_id": 1,
    "doctor_id": 2,
    "record_type": "consultation",
    "status": "created"
  },
  "message": "Medical record created"
}
```

---

### TC-9.04 ✅ Update Medical Record (Doctor)

- **Method:** `PUT`
- **URL:** `http://localhost/healthcare-project/public/api/records/1`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "diagnosis": "Migraine",
  "treatment": "Sumatriptan 50mg as needed",
  "notes": "Referred to neurologist"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "diagnosis": "Migraine" },
  "message": "Medical record updated"
}
```

---

### TC-9.05 ❌ Get Records — Non-Existent Patient

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/records/patient/9999`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `404 Not Found` or `200 OK` with empty array

---

### TC-9.06 ❌ Create Medical Record — Without Authentication

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/records`
- **Headers:** *(none)*
- **Expected Status:** `401 Unauthorized`

---

### TC-9.07 ❌ Get Record — Non-Existent Record ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/records/9999`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `404 Not Found`

---

### TC-9.08 ❌ Create Record — Missing CSRF Token

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/records`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  Content-Type: application/json
  ```
  *(X-CSRF-Token missing)*
- **Body:** *(valid body)*
- **Expected Status:** `403 Forbidden`

---

## MODULE 10 — Messages / Appointment Communication (5 Test Cases)

> **Access:** All authenticated users within the tenant can send/view messages linked to appointments.

---

### TC-10.01 ✅ Get Messages for Appointment

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/messages/1`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "appointment_id": 1,
      "sender_id": 2,
      "message": "Patient should fast 8 hours before blood draw.",
      "message_type": "instruction",
      "created_at": "2026-02-20T09:00:00"
    }
  ],
  "message": "Messages retrieved"
}
```

---

### TC-10.02 ✅ Send Message (Note Type)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/messages`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  Content-Type: application/json
  X-CSRF-Token: <csrf_token>
  ```
- **Body:**
```json
{
  "appointment_id": 1,
  "message": "Patient reports improvement. Continue medication.",
  "message_type": "note"
}
```
- **Expected Status:** `201 Created`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "appointment_id": 1,
    "sender_id": 2,
    "message": "Patient reports improvement. Continue medication.",
    "message_type": "note"
  },
  "message": "Message sent"
}
```
- **Valid message_type values:** `note`, `message`, `instruction`

---

### TC-10.03 ✅ Send Instruction (Pharmacist)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/messages`
- **Headers:** *(pharmacist auth + CSRF)*
- **Body:**
```json
{
  "appointment_id": 1,
  "message": "Take Amlodipine 5mg daily before breakfast. Avoid grapefruit.",
  "message_type": "instruction"
}
```
- **Expected Status:** `201 Created`

---

### TC-10.04 ❌ Send Message — Non-Existent Appointment ID

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/messages`
- **Headers:** *(auth + CSRF)*
- **Body:**
```json
{
  "appointment_id": 9999,
  "message": "Test message",
  "message_type": "note"
}
```
- **Expected Status:** `422 Unprocessable Entity` or `404 Not Found`

---

### TC-10.05 ❌ Get Messages — Unauthenticated

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/messages/1`
- **Headers:** *(none)*
- **Expected Status:** `401 Unauthorized`

---

## MODULE 11 — Calendar (5 Test Cases)

> **Access:** All authenticated users. Doctors see their own calendar only.

---

### TC-11.01 ✅ Get Calendar Events for Date Range (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/calendar`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params:** `start_date=2026-02-01&end_date=2026-02-28&doctor_id=2`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "appointment_date": "2026-02-20",
      "start_time": "10:00:00",
      "end_time": "10:30:00",
      "patient_id": 1,
      "doctor_id": 2,
      "status": "scheduled",
      "type": "consultation"
    }
  ],
  "message": "Calendar events retrieved"
}
```
- **Default range:** Current month start to end if no params provided.

---

### TC-11.02 ✅ Get Calendar Events (Doctor — Own Only)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/calendar`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  ```
- **Expected Status:** `200 OK`
- **Notes:** Doctor's `doctor_id` filter is auto-applied. They cannot view another doctor's calendar.

---

### TC-11.03 ✅ Get Calendar Events by Specific Date (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/calendar/2026-02-20`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params (optional):** `doctor_id=2`
- **Expected Status:** `200 OK`
- **Expected Response:** Events for that specific date only.

---

### TC-11.04 ✅ Get Calendar Events by Date (Doctor)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/calendar/2026-02-20`
- **Headers:**
  ```
  Authorization: Bearer <doctor_access_token>
  ```
- **Expected Status:** `200 OK`
- **Notes:** Doctor sees only their own events for that date.

---

### TC-11.05 ❌ Get Calendar Events — No Token

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/calendar`
- **Headers:** *(none)*
- **Expected Status:** `401 Unauthorized`

---

## MODULE 12 — Dashboard, Settings & Tenant Roles (7 Test Cases)

---

### TC-12.01 ✅ Get Dashboard Summary

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/dashboard`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "total_patients": 25,
    "total_appointments_today": 8,
    "total_appointments_week": 42,
    "pending_prescriptions": 5,
    "pending_invoices": 3,
    "total_staff": 12
  },
  "message": "Dashboard data retrieved"
}
```

---

### TC-12.02 ✅ Get Audit Logs (Admin)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/settings/audit-logs`
- **Headers:**
  ```
  Authorization: Bearer <admin_access_token>
  ```
- **Query Params:** `page=1&per_page=50&action=LOGIN&user_id=1&severity=warning`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "tenant_id": 1,
      "user_id": 1,
      "action": "LOGIN",
      "severity": "info",
      "status": "success",
      "ip_address": "127.0.0.1",
      "created_at": "2026-02-20T09:00:00"
    }
  ],
  "message": "Audit logs retrieved"
}
```
- **Filter options:** `action` (LOGIN, LOGOUT, USER_CREATED, etc.), `user_id`, `severity` (info, warning, critical)
- **Default per_page:** 50

---

### TC-12.03 ✅ Regenerate CSRF (Settings)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/settings/csrf/regenerate`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "csrf_token": "eyJ..." },
  "message": "CSRF token regenerated"
}
```
- **Notes:** No X-CSRF-Token required for this route.

---

### TC-12.04 ✅ Get Tenant Roles (Any Authenticated User)

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/tenants/roles`
- **Headers:**
  ```
  Authorization: Bearer <access_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    { "id": 1, "name": "Admin", "slug": "admin", "is_system_role": true },
    { "id": 2, "name": "Doctor", "slug": "doctor", "is_system_role": true },
    { "id": 3, "name": "Nurse", "slug": "nurse", "is_system_role": true },
    { "id": 4, "name": "Receptionist", "slug": "receptionist", "is_system_role": true },
    { "id": 5, "name": "Pharmacist", "slug": "pharmacist", "is_system_role": true },
    { "id": 6, "name": "Patient", "slug": "patient", "is_system_role": true }
  ],
  "message": "Roles retrieved"
}
```

---

### TC-12.05 ❌ Audit Logs — Suspended Tenant

- **Prerequisite:** Tenant is suspended by platform admin.
- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/settings/audit-logs`
- **Headers:**
  ```
  Authorization: Bearer <valid_but_suspended_tenant_token>
  ```
- **Expected Status:** `403 Forbidden`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Tenant is not active"
}
```
- **Notes:** TenantMiddleware blocks all requests if tenant status != `active`.

---

### TC-12.06 ❌ Dashboard — Expired Access Token

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/dashboard`
- **Headers:**
  ```
  Authorization: Bearer <expired_access_token>
  ```
- **Expected Status:** `401 Unauthorized`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Unauthorized. Token missing or invalid."
}
```

---

### TC-12.07 ❌ Rate Limiting — Exceed 100 Requests Per Minute

- **Method:** Repeatedly call any endpoint > 100 times within 60 seconds
- **URL:** `http://localhost/healthcare-project/public/api/health`
- **Expected Status:** `429 Too Many Requests`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Rate limit exceeded. Try again later."
}
```

---

## MODULE 13 — Platform Admin (13 Test Cases)

> **Completely separate auth layer.** Platform admin manages tenants only — not individual users inside tenants.

---

### TC-13.01 ✅ Platform Admin Login — Valid Credentials

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/platform/login`
- **Headers:**
  ```
  Content-Type: application/json
  ```
- **Body:**
```json
{
  "username": "platform_admin",
  "password": "Platform@123"
}
```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "access_token": "eyJ...",
    "csrf_token": "eyJ...",
    "token_type": "Bearer",
    "admin": {
      "id": 1,
      "username": "platform_admin",
      "role": "platform_admin"
    }
  },
  "message": "Platform admin login successful"
}
```
- **Notes:** Save `access_token` as `platform_token` and `csrf_token` as `platform_csrf`.

---

### TC-13.02 ❌ Platform Admin Login — Wrong Password

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/platform/login`
- **Body:**
```json
{
  "username": "platform_admin",
  "password": "WrongPassword"
}
```
- **Expected Status:** `401 Unauthorized`

---

### TC-13.03 ✅ Platform Admin — Get Current Admin Info

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/platform/me`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "platform_admin",
    "role": "platform_admin"
  },
  "message": "Platform admin info"
}
```

---

### TC-13.04 ✅ Platform Admin — Regenerate CSRF Token

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/platform/csrf/regenerate`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "csrf_token": "eyJ..." },
  "message": "CSRF token regenerated"
}
```

---

### TC-13.05 ✅ Platform Admin — List All Tenants

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Query Params:** `page=1&per_page=20&status=pending`
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Apollo Hospital Chennai",
      "subdomain": "apollo-chennai",
      "status": "active",
      "subscription_plan": "premium",
      "contact_email": "admin@apollo-chennai.com",
      "created_at": "2026-01-01T00:00:00"
    },
    {
      "id": 2,
      "name": "City Medical Center",
      "subdomain": "city-medical",
      "status": "inactive",
      "subscription_plan": "trial"
    }
  ],
  "message": "Tenants retrieved"
}
```

---

### TC-13.06 ✅ Platform Admin — Get Tenant by ID

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/2`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "name": "City Medical Center",
    "subdomain": "city-medical",
    "status": "inactive",
    "contact_email": "admin@citymedical.com",
    "subscription_plan": "trial"
  },
  "message": "Tenant retrieved"
}
```

---

### TC-13.07 ✅ Platform Admin — Approve Tenant

- **Prerequisite:** Tenant ID 2 is in `status=inactive` (pending approval).
- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/2/approve`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  X-CSRF-Token: <platform_csrf>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": {
    "id": 2,
    "status": "active"
  },
  "message": "Tenant approved successfully. Hospital can now login."
}
```

---

### TC-13.08 ✅ Platform Admin — Suspend Active Tenant

- **Prerequisite:** Tenant ID 1 is `status=active`.
- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/1/suspend`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  X-CSRF-Token: <platform_csrf>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Tenant suspended successfully"
}
```

---

### TC-13.09 ✅ Platform Admin — Reactivate Suspended Tenant

- **Prerequisite:** Tenant ID 1 is `status=suspended`.
- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/1/reactivate`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  X-CSRF-Token: <platform_csrf>
  ```
- **Body:** *(none)*
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": { "id": 1, "status": "active" },
  "message": "Tenant reactivated successfully"
}
```

---

### TC-13.10 ❌ Platform Admin — Get Non-Existent Tenant

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/9999`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Expected Status:** `404 Not Found`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Tenant not found"
}
```

---

### TC-13.11 ❌ Platform Admin Route — Using Tenant Token

- **Prerequisite:** Use the regular tenant user's `access_token` (not platform token).
- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants`
- **Headers:**
  ```
  Authorization: Bearer <tenant_user_access_token>
  ```
- **Expected Status:** `401 Unauthorized`
- **Notes:** Platform admin middleware validates a different token type. Tenant user tokens are rejected.

---

### TC-13.12 ✅ Platform Admin — Logout

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/platform/logout`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  ```
- **Expected Status:** `200 OK`
- **Expected Response:**
```json
{
  "success": true,
  "data": null,
  "message": "Logged out successfully"
}
```

---

### TC-13.13 ❌ Platform Admin — Approve Non-Existent Tenant

- **Method:** `PATCH`
- **URL:** `http://localhost/healthcare-project/public/api/platform/tenants/9999/approve`
- **Headers:**
  ```
  Authorization: Bearer <platform_token>
  X-CSRF-Token: <platform_csrf>
  ```
- **Expected Status:** `404 Not Found`

---

## SECTION 3 — CROSS-CUTTING SECURITY TEST CASES

---

### TC-SEC-01 ❌ Cross-Tenant Data Access

- **Scenario:** Tenant 1's admin attempts to access Tenant 2's patient via the same endpoint.
- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/patients/99`  *(patient belongs to tenant_id=2)*
- **Headers:**
  ```
  Authorization: Bearer <tenant_1_admin_token>
  ```
- **Expected Status:** `404 Not Found`
- **Notes:** TenantMiddleware + service layer always filters by `auth_tenant_id`. Cross-tenant access is impossible — data is silently not found.

---

### TC-SEC-02 ❌ Tampered JWT Token

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/dashboard`
- **Headers:**
  ```
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.TAMPERED.SIGNATURE
  ```
- **Expected Status:** `401 Unauthorized`
- **Notes:** HS256 signature verification fails. `hash_equals()` comparison catches signature mismatch.

---

### TC-SEC-03 ❌ CSRF Token Used as Access Token

- **Method:** `GET`
- **URL:** `http://localhost/healthcare-project/public/api/dashboard`
- **Headers:**
  ```
  Authorization: Bearer <csrf_token>
  ```
- **Expected Status:** `401 Unauthorized`
- **Notes:** `AuthService::validateAccessToken()` explicitly rejects tokens with `type=csrf` payload.

---

### TC-SEC-04 ❌ Missing Content-Type Header on POST

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/auth/login`
- **Headers:**
  ```
  Content-Type: text/plain
  ```
- **Body:** `tenant_id=1&username=admin&password=Admin@123456`
- **Expected Status:** `400 Bad Request`
- **Notes:** `JsonValidatorMiddleware` enforces `Content-Type: application/json` on POST/PUT/PATCH routes.

---

### TC-SEC-05 ❌ Subdomain Already Taken (Registration)

- **Method:** `POST`
- **URL:** `http://localhost/healthcare-project/public/api/register`
- **Body:**
```json
{
  "hospital_name": "Another Apollo",
  "subdomain": "apollo-chennai",
  "contact_email": "other@example.com",
  "admin_username": "anotheradmin",
  "admin_password": "Admin@1234"
}
```
- **Expected Status:** `422 Unprocessable Entity`
- **Expected Response:**
```json
{
  "success": false,
  "error": "Subdomain is already taken",
  "details": {
    "subdomain": "This subdomain is not available"
  }
}
```

---

## SECTION 4 — TEST EXECUTION ORDER (Recommended)

For a clean test run against a fresh database, follow this order:

```
1.  TC-1.01  — Health check (verify API is up)
2.  TC-13.01 — Platform admin login
3.  TC-1.02  — Register new tenant
4.  TC-13.07 — Approve the new tenant
5.  TC-2.01  — Admin login (tenant 1)
6.  TC-3.03  — Create nurse user
7.  TC-3.03  — Create receptionist user
8.  TC-3.03  — Create pharmacist user
9.  TC-4.07  — Create patient record
10. TC-5.07  — Create appointment (staff)
11. TC-6.04  — Create prescription (doctor)
12. TC-7.04  — Create invoice (receptionist)
13. TC-8.03  — Create staff record (admin)
14. TC-9.03  — Create medical record (doctor)
15. TC-10.02 — Send appointment message
16. All remaining test cases
```

---

## SECTION 5 — RESPONSE FORMAT REFERENCE

### Success Response
```json
{
  "success": true,
  "data": { ... } | [ ... ] | null,
  "message": "Human readable message"
}
```

### Error Response
```json
{
  "success": false,
  "error": "Error description",
  "code": "OPTIONAL_ERROR_CODE",
  "details": {
    "field_name": "Field-specific error"
  }
}
```

### HTTP Status Code Reference

| Status | Meaning |
|--------|---------|
| `200` | Success (GET, PUT, PATCH, DELETE) |
| `201` | Created (POST) |
| `400` | Bad Request (invalid Content-Type, malformed JSON) |
| `401` | Unauthorized (missing/invalid/expired token) |
| `403` | Forbidden (valid token, insufficient role; or invalid CSRF) |
| `404` | Not Found (resource does not exist or belongs to another tenant) |
| `422` | Unprocessable Entity (validation errors) |
| `429` | Too Many Requests (rate limit exceeded) |
| `500` | Internal Server Error (unexpected failures) |

---

*End of updated-testcase.md — Total: 120 test cases across 13 modules + 5 security cases*
